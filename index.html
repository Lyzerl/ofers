<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מערכת הצעות מחיר לקייטרינג</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .form-row {
            display: flex;
            margin-bottom: 15px;
        }
        .form-group {
            flex: 1;
            margin-right: 10px;
        }
        .form-group:last-child {
            margin-right: 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        #summary {
            margin-top: 20px;
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }
        #menuItems {
            margin-top: 20px;
        }
        .menu-category {
            margin-bottom: 15px;
        }
        .menu-category h3 {
            margin-bottom: 10px;
        }
        .menu-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .menu-item input[type="checkbox"] {
            margin-right: 10px;
        }
        .menu-item input[type="number"] {
            width: 60px;
            margin-left: 10px;
        }
        @media (max-width: 600px) {
            .form-row {
                flex-direction: column;
            }
            .form-group {
                margin-right: 0;
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>מערכת הצעות מחיר לקייטרינג</h1>
        <form id="quoteForm">
            <div class="form-row">
                <div class="form-group">
                    <label for="clientName">שם לקוח:</label>
                    <input type="text" id="clientName" required>
                </div>
                <div class="form-group">
                    <label for="clientPhone">טלפון:</label>
                    <input type="tel" id="clientPhone" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="clientEmail">דוא"ל:</label>
                    <input type="email" id="clientEmail" required>
                </div>
                <div class="form-group">
                    <label for="eventLocation">מיקום האירוע:</label>
                    <input type="text" id="eventLocation" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="address">כתובת:</label>
                    <input type="text" id="address" required>
                </div>
                <div class="form-group">
                    <label for="eventDate">תאריך:</label>
                    <input type="date" id="eventDate" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="contactPerson">איש קשר:</label>
                    <input type="text" id="contactPerson" required>
                </div>
                <div class="form-group">
                    <label for="contactPhone">טלפון איש קשר:</label>
                    <input type="tel" id="contactPhone" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="menuType">סוג תפריט:</label>
                    <select id="menuType" required>
                        <option value="">בחר תפריט</option>
                        <!-- אפשרויות התפריט ייטענו דינמית -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="guestCount">מספר אורחים:</label>
                    <input type="number" id="guestCount" required min="1">
                </div>
            </div>
            <div id="menuItems">
                <!-- פריטי התפריט ייטענו דינמית -->
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="delivery">הובלה:</label>
                    <input type="number" id="delivery" value="0" min="0">
                </div>
            </div>
            <div id="summary">
                <!-- סיכום ההזמנה יוצג כאן -->
            </div>
            <div class="form-row">
                <button type="button" onclick="exportToPDF()">ייצוא ל-PDF</button>
                <button type="button" onclick="exportToExcel()">ייצוא ל-Excel</button>
            </div>
        </form>
    </div>

    <script>
        // נתוני התפריטים והמחירון
        const menuTypes = {
            "בסיסי": {"salads": 5, "starters": 1, "mainDishes": 1, "sideDishes": 3, "desserts": 0, "pricePerPerson": 55},
            "משודרג": {"salads": 8, "starters": 1, "mainDishes": 2, "sideDishes": 3, "desserts": 1, "pricePerPerson": 65},
            "דלוקס": {"salads": 12, "starters": 2, "mainDishes": 2, "sideDishes": 5, "desserts": 1, "pricePerPerson": 95}
        };

        const priceList = {
            "סלטים": {"חומוס": 1.1, "חציל קלוי": 1.1, "טחינה": 1.1},
            "מנה ראשונה": {"בורקס ברוטב": 5, "דג מושט": 8, "מוסקה בשרי": 5},
            "מנה עיקרית": {"כרעיים": 10, "שניצל מטוגן": 12, "רולדה": 12},
            "תוספות": {"אורז עם חמוציות": 1.5, "קוסקוס": 1.5, "תפוחי אדמה אפויים": 1.5},
            "קינוח": {"סופלה": 1, "גלידונית": 0.75}
        };

        // טעינת אפשרויות התפריט
        const menuTypeSelect = document.getElementById('menuType');
        for (const type in menuTypes) {
            const option = document.createElement('option');
            option.value = type;
            option.textContent = type;
            menuTypeSelect.appendChild(option);
        }

        // פונקציה לטעינת פריטי התפריט
        function loadMenuItems() {
            const menuType = document.getElementById('menuType').value;
            const menuItemsContainer = document.getElementById('menuItems');
            menuItemsContainer.innerHTML = '';

            if (menuType) {
                for (const category in priceList) {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = 'menu-category';
                    categoryDiv.innerHTML = `<h3>${category}</h3>`;

                    for (const item in priceList[category]) {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'menu-item';
                        itemDiv.innerHTML = `
                            <input type="checkbox" id="${item}" name="${category}" value="${item}">
                            <label for="${item}">${item} (₪${priceList[category][item]})</label>
                            <input type="number" id="${item}_quantity" min="0" value="0" style="width: 50px;">
                        `;
                        categoryDiv.appendChild(itemDiv);
                    }

                    menuItemsContainer.appendChild(categoryDiv);
                }
            }
        }

        // הוספת מאזין אירועים לשינוי בסוג התפריט
        document.getElementById('menuType').addEventListener('change', loadMenuItems);

        // פונקציה לחישוב סיכום ההזמנה
        function calculateSummary() {
            const menuType = document.getElementById('menuType').value;
            const guestCount = parseInt(document.getElementById('guestCount').value) || 0;
            const deliveryCost = parseFloat(document.getElementById('delivery').value) || 0;

            if (!menuType || guestCount === 0) {
                document.getElementById('summary').innerHTML = '<p>נא למלא את כל השדות הנדרשים.</p>';
                return;
            }

            let totalCost = menuTypes[menuType].pricePerPerson * guestCount;
            let additionalItems = [];

            document.querySelectorAll('#menuItems input[type="checkbox"]:checked').forEach(item => {
                const category = item.name;
                const itemName = item.value;
                const quantity = parseInt(document.getElementById(`${itemName}_quantity`).value) || 0;
                const price = priceList[category][itemName];
                const itemTotal = price * quantity;
                totalCost += itemTotal;
                if (quantity > 0) {
                    additionalItems.push(`${itemName} (${quantity}x): ₪${itemTotal.toFixed(2)}`);
                }
            });

            totalCost += deliveryCost;

            let summaryHTML = `
                <h2>סיכום הזמנה</h2>
                <p>סוג תפריט: ${menuType}</p>
                <p>מספר אורחים: ${guestCount}</p>
                <p>מחיר בסיס למנה: ₪${menuTypes[menuType].pricePerPerson}</p>
                <p>סה"כ מחיר בסיס: ₪${(menuTypes[menuType].pricePerPerson * guestCount).toFixed(2)}</p>
            `;

            if (additionalItems.length > 0) {
                summaryHTML += '<h3>פריטים נוספים:</h3><ul>';
                additionalItems.forEach(item => {
                    summaryHTML += `<li>${item}</li>`;
                });
                summaryHTML += '</ul>';
            }

            summaryHTML += `
                <p>עלות הובלה: ₪${deliveryCost.toFixed(2)}</p>
                <h3>סה"כ לתשלום: ₪${totalCost.toFixed(2)}</h3>
            `;

            document.getElementById('summary').innerHTML = summaryHTML;
        }

        // הוספת מאזיני אירועים לשינויים בטופס
        document.getElementById('quoteForm').addEventListener('change', calculateSummary);

        // פונקציה לייצוא ל-PDF
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // הגדרת הכותרת
            doc.setFont("helvetica", "bold");
            doc.setFontSize(18);
            doc.text("הצעת מחיר לקייטרינג", 105, 20, null, null, "center");
            
            // הוספת פרטי הלקוח
            doc.setFontSize(12);
            doc.setFont("helvetica", "normal");
            doc.text(`שם לקוח: ${document.getElementById('clientName').value}`, 10, 40);
            doc.text(`טלפון: ${document.getElementById('clientPhone').value}`, 10, 50);
            doc.text(`דוא"ל: ${document.getElementById('clientEmail').value}`, 10, 60);
            doc.text(`מיקום האירוע: ${document.getElementById('eventLocation').value}`, 10, 70);
            doc.text(`תאריך: ${document.getElementById('eventDate').value}`, 10, 80);
            
            // הוספת סיכום ההזמנה
            const summaryContent = document.getElementById('summary').innerText;
            const summaryLines = doc.splitTextToSize(summaryContent, 180);
            doc.text(summaryLines, 10, 100);
            
            // שמירת הקובץ
            doc.save("הצעת_מחיר_קייטרינג.pdf");
        }

        // פונקציה לייצוא ל-Excel
        function exportToExcel() {
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.table_to_sheet(document.getElementById('summary'));
            XLSX.utils.book_
